---
// Layout
import Layout from '~/layouts/Layout.astro';

// Atoms
import Link from '~/atoms/Link.astro';

// Components
import Cell from '~/components/Cell.astro';

// Sections
import Main from '~/section/Main.astro';
import { getCollection } from 'astro:content';

// Consts
import { CULTURE_PAGES } from '~/constants/Culture';

// Types
import type { RouteType } from '~/types/Routes';
import CultureService from '~/services/CultureService';

const postsCollection = await getCollection('culture');
const pathname = Astro.url.pathname as RouteType;
const [, , category] = pathname.split('/');

const importedImages = import.meta.glob<{ default: ImageMetadata }>(
  `/src/assets/images/culture/{lookbooks,posts}/*.{jpeg,jpg,png,gif,webp}`,
);

const posts = CultureService.getItems(postsCollection, category);
---

<Layout
  headerSize="small"
  mainSize="large"
  asideSize="small"
  asideBackground="main"
  asideScroll={true}
  logoSize="small"
>
  <Main class="m-0 w-2/3 p-0 pr-16">
    <div
      class="font-anton flex h-24 w-full justify-end gap-4 p-4 text-5xl font-normal"
    >
      {
        CULTURE_PAGES.map((page) => (
          <Link
            href={page.href}
            class="text-5xl"
            class:list={{
              'text-theme-main': pathname === page.href,
            }}
          >
            [{page.name}]
          </Link>
        ))
      }
    </div>
    <div class="hidden-scrollbar flex flex-wrap" id="scroll-section">
      {
        posts.map((post) => {
          const { collection, data, slug } = post;
          const [postCategory] = slug.split('/');

          return (
            <Cell
              href={`/${collection}/${slug}`}
              class="aspect-4/3 basis-1/3"
              slug={slug}
              category={postCategory}
              title={data.title}
              subtitle={data.subtitle}
              image={importedImages[data.mainImage]()}
              alt={data.subtitle}
            />
          );
        })
      }
    </div>
  </Main>
</Layout>
